
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Casa-distro concepts &#8212; CASA-Distro - BrainVisa / CATI development distribution</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Technical issues" href="technical.html" />
    <link rel="prev" title="Casa-Distro" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="technical.html" title="Technical issues"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="index.html" title="Casa-Distro"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CASA-Distro</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Casa-distro concepts</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="casa-distro-concepts">
<h1>Casa-distro concepts<a class="headerlink" href="#casa-distro-concepts" title="Permalink to this heading">¶</a></h1>
<section id="repository">
<span id="id1"></span><h2>repository<a class="headerlink" href="#repository" title="Permalink to this heading">¶</a></h2>
<p>The <em>repository</em> is the root directory for all casa-distro files. It contains <a class="reference internal" href="#image"><span class="std std-ref">container images</span></a> and <a class="reference internal" href="#environment"><span class="std std-ref">environments</span></a>.</p>
</section>
<section id="environment">
<span id="id2"></span><h2>environment<a class="headerlink" href="#environment" title="Permalink to this heading">¶</a></h2>
<p>An <em>environment</em> is a workspace, directory and associated container image(s), containing a user installation of the applications (<a class="reference external" href="http://brainvisa.info">BrainVISA</a> software) or a developer build (sources and build).</p>
<p>It represents all what is necessary to work on a <a class="reference internal" href="#distro"><span class="std std-ref">distro</span></a> at
a given version for a given operating system. In <code class="docutils literal notranslate"><span class="pre">casa_distro</span></code>, an
environment is identified by several variables:</p>
<div class="line-block">
<div class="line">- <a class="reference internal" href="#env-name"><span class="std std-ref">name</span></a></div>
<div class="line">- <a class="reference internal" href="#env-type"><span class="std std-ref">type</span></a></div>
<div class="line">- <a class="reference internal" href="#distro"><span class="std std-ref">distro</span></a></div>
<div class="line">- <a class="reference internal" href="#branch"><span class="std std-ref">branch</span></a></div>
<div class="line">- <a class="reference internal" href="#system"><span class="std std-ref">system</span></a></div>
<div class="line">- <a class="reference internal" href="#version"><span class="std std-ref">version</span></a></div>
</div>
<p>Note that in casa-distro 2, we used to call this environment “<em>build workflow</em>”. We changed the name after extending it to user “run” environments which are not designed to build the software but just to use it.</p>
<p>An environment is based on an <a class="reference internal" href="#image"><span class="std std-ref">image</span></a> located at the <a class="reference internal" href="#repository"><span class="std std-ref">repository</span></a> level. In some situations (developer environments with tests, release building) several <a class="reference internal" href="#image"><span class="std std-ref">images</span></a> may be used within a single environment.</p>
<p>The hardware representation of an environment is a set of directories in the <a class="reference internal" href="#repository"><span class="std std-ref">repository</span></a>, under the sub-directory named after th <a class="reference internal" href="#env-name"><span class="std std-ref">environment name</span></a>:</p>
<ul>
<li><p>For a <strong>user environment</strong>:</p>
<div class="line-block">
<div class="line">- <strong>host/conf:</strong> configuration of the environment (config file, etc.). There are some predefined content for <code class="docutils literal notranslate"><span class="pre">conf</span></code> that can be generated with the command <code class="docutils literal notranslate"><span class="pre">casa_distro</span> <span class="pre">setup</span></code> but the whole environment can be customized by editing files in this directory.</div>
<div class="line">- <strong>host/host_bin:</strong> directory containing run scripts for all <a class="reference external" href="http://brainvisa.info">BrainVISA</a> executable programs, and also the <a class="reference internal" href="bv_command.html"><span class="doc">The bv command</span></a>. Programs here are meant to be run from the <em>host machine</em>, not from within the container. This directory can safely be setup in the host system <code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable.</div>
<div class="line">- <strong>host/python:</strong> contains the python modules needed to run the <a class="reference internal" href="bv_command.html"><span class="doc">The bv command</span></a> on the <em>host machine</em> side.</div>
<div class="line">- <strong>home:</strong> a “home directory” for the user inside the casa-distro container of the environment. This is separated from the host home directory because as it is a container, the configuration here may differ from the host one, and cause confusions and incompatibilities.</div>
<div class="line">- <strong>install:</strong> the <a class="reference external" href="http://brainvisa.info">BrainVISA</a> distribution directory. This directory is actually in the container image, and is not visible from the host machine.</div>
</div>
</li>
<li><p>for a <strong>developer environment</strong>:</p>
<div class="line-block">
<div class="line">- <strong>host/conf:</strong> configuration of the environment (config file, BioProj passwords, <code class="docutils literal notranslate"><span class="pre">bv_maker.cfg</span></code>, etc.). The content of this directory is the input of the compilation, packaging and testing steps. There are some predefined content for <code class="docutils literal notranslate"><span class="pre">conf</span></code> that can be generated with the command <code class="docutils literal notranslate"><span class="pre">casa_distro</span> <span class="pre">setup_dev</span></code> but the whole environment can be customized by editing files in this directory.</div>
<div class="line">- <strong>host/src:</strong> source of selected components for the workflow. The content
of this directory is first created by <code class="docutils literal notranslate"><span class="pre">bv_maker</span></code> from within a
Docker container running the targeted operting system. Simply call
<code class="docutils literal notranslate"><span class="pre">casa_distro</span> <span class="pre">bv_maker</span></code> for this. The same command can be used to
update sources to latest revision or to recompile when source code has
been modified.</div>
<div class="line">- <strong>host/build:</strong> build directory used for compilation. Like the <code class="docutils literal notranslate"><span class="pre">src</span></code>
directory, the content of this directory is created by commands such
as <code class="docutils literal notranslate"><span class="pre">casa_distro</span> <span class="pre">bv_maker</span></code>.</div>
<div class="line">- <strong>host/install:</strong> directory containing distribution packages. Packages that
are created by bv_maker are stored in that directory.</div>
<div class="line">- <strong>home:</strong> a “home directory” for the user inside the casa-distro container of the environment. This is separated from the host home directory because as it is a container, the configuration here may differ from the host one, and cause confusions and incompatibilities.</div>
<div class="line">- <strong>test:</strong> directory used during testing. Typically reference data
will be downloaded in this directory and compared to test data
generated, in this directory, by test commands.</div>
</div>
</li>
</ul>
</section>
<section id="environment-type">
<span id="env-type"></span><h2>environment type<a class="headerlink" href="#environment-type" title="Permalink to this heading">¶</a></h2>
<p>There are two environment types:
* <code class="docutils literal notranslate"><span class="pre">user</span></code>: the environment is an installation of a ready-to-run, precompiled <a class="reference external" href="http://brainvisa.info">BrainVISA</a> distribution in a container image. It is designed for users who just need to run the software.
* <code class="docutils literal notranslate"><span class="pre">dev</span></code>: the environment is a developer environment, it is using a container image containing all development tools, and will hold source code and compilation files.</p>
</section>
<section id="environment-name">
<span id="env-name"></span><h2>environment name<a class="headerlink" href="#environment-name" title="Permalink to this heading">¶</a></h2>
<p>Identifier for the <a class="reference internal" href="#environment"><span class="std std-ref">environment</span></a>. The <em>name</em> has to be unique in a <a class="reference internal" href="#repository"><span class="std std-ref">repository</span></a> and can be used as a shortcut to select a specific environment, once setup and installed: it can replace <a class="reference internal" href="#distro"><span class="std std-ref">distro</span></a>, <a class="reference internal" href="#branch"><span class="std std-ref">branch</span></a>, <a class="reference internal" href="#version"><span class="std std-ref">version</span></a>, <a class="reference internal" href="#system"><span class="std std-ref">system</span></a> and <a class="reference internal" href="#env-type"><span class="std std-ref">type</span></a> to select an existing environment.</p>
<blockquote>
<div></div></blockquote>
</section>
<section id="distro">
<span id="id3"></span><h2>distro<a class="headerlink" href="#distro" title="Permalink to this heading">¶</a></h2>
<p>The identifier of the <em>distro</em> (distribution). It represents a set of software handled (installed or built) in the <a class="reference internal" href="#environment"><span class="std std-ref">environment</span></a>. Software distributions managed by casa-distro are composed of many versioned software components
(more than 50 at the time of this writing).</p>
<p>There are a few predefined <em>distro</em> in casa-distro:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">opensource</span></code>: brainvisa projects subset which are fully open-source and don’t need a personal login/password to access the sources repositories. The contain the core libraries and software infrastructure (Aims, Anatomist, Axon, Soma-Workflow, Capsul, and more)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">brainvisa</span></code>: all <a class="reference external" href="http://brainvisa.info">BrainVISA</a> public distribution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cati</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cea</span></code>: complete <a class="reference external" href="http://brainvisa.info">BrainVISA</a> components, including internal (non-publicly distributed) components</p></li>
</ul>
</section>
<section id="system">
<span id="id4"></span><h2>system<a class="headerlink" href="#system" title="Permalink to this heading">¶</a></h2>
<p>the operating system the <a class="reference internal" href="#distro"><span class="std std-ref">distro</span></a> is built for (<em>e.g.</em> <code class="docutils literal notranslate"><span class="pre">ubuntu-18.04</span></code>, <code class="docutils literal notranslate"><span class="pre">ubuntu-20.04</span></code>, we used to have also <code class="docutils literal notranslate"><span class="pre">win32</span></code> or <code class="docutils literal notranslate"><span class="pre">win64</span></code>).</p>
</section>
<section id="branch">
<span id="id5"></span><h2>branch<a class="headerlink" href="#branch" title="Permalink to this heading">¶</a></h2>
<p>The name of the virtual <a class="reference internal" href="#branch"><span class="std std-ref">branch</span></a> used to select software component sources (<code class="docutils literal notranslate"><span class="pre">latest_release</span></code>, <code class="docutils literal notranslate"><span class="pre">master</span></code> or <code class="docutils literal notranslate"><span class="pre">integration</span></code>) in an <a class="reference internal" href="#environment"><span class="std std-ref">environment</span></a>. This variable is only used in <em>developer environments</em>, when <em>user environments</em> use <a class="reference internal" href="#version"><span class="std std-ref">version</span></a> instead.</p>
</section>
<section id="version">
<span id="id6"></span><h2>version<a class="headerlink" href="#version" title="Permalink to this heading">¶</a></h2>
<p>The version of the user distribution of <a class="reference external" href="http://brainvisa.info">BrainVISA</a>.</p>
</section>
<section id="image">
<span id="id7"></span><h2>image<a class="headerlink" href="#image" title="Permalink to this heading">¶</a></h2>
<p>Container image file, located in the <a class="reference internal" href="#repository"><span class="std std-ref">repository</span></a>. Casa-distro can use Singularity images (<code class="docutils literal notranslate"><span class="pre">.sif</span></code> or <code class="docutils literal notranslate"><span class="pre">.simg</span></code> files), Docker images (located in the docker images repository, not in Casa-distro repository directory), or VirtualBox images (<code class="docutils literal notranslate"><span class="pre">.vdi</span></code> or <code class="docutils literal notranslate"><span class="pre">.ova</span></code> files).</p>
<p>An images may be of three types:
* <strong>user image:</strong> user-oriented, it contains a full system with <a class="reference external" href="http://brainvisa.info">BrainVISA</a> already installed in it.
* <strong>dev image:</strong> developer-oriented, it contains a system with all needed development tools, but not the <a class="reference external" href="http://brainvisa.info">BrainVISA</a> software which are meant to be built by the developer, in the <a class="reference internal" href="#environment"><span class="std std-ref">environment</span></a> but outside of the image.
* <strong>run image:</strong> normally not used by users nor by developers, but used by distribution maintainers to build a <a class="reference external" href="http://brainvisa.info">BrainVISA</a> release (user image): it contains a system with the needed runtime third-party libraries and modules required to run the <a class="reference external" href="http://brainvisa.info">BrainVISA</a> software. It is thus lighter than the corresponding dev image. A user image is a run image with <a class="reference external" href="http://brainvisa.info">BrainVISA</a> additionally installed in it.</p>
</section>
<section id="image-version">
<span id="id8"></span><h2>image_version<a class="headerlink" href="#image-version" title="Permalink to this heading">¶</a></h2>
<p>Version of the image. This should not be confused with the branch or versions of the software to be built and packaged in the final user image (this is the <a class="reference internal" href="#version"><span class="std std-ref">version</span></a> tag). This more represents the system and variants (for instance in BrainVisa, image_version 5.3 corresponds to an Ubuntu 22.04 system with python 3.10 and Qt 5).</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Casa-distro concepts</a><ul>
<li><a class="reference internal" href="#repository">repository</a></li>
<li><a class="reference internal" href="#environment">environment</a></li>
<li><a class="reference internal" href="#environment-type">environment type</a></li>
<li><a class="reference internal" href="#environment-name">environment name</a></li>
<li><a class="reference internal" href="#distro">distro</a></li>
<li><a class="reference internal" href="#system">system</a></li>
<li><a class="reference internal" href="#branch">branch</a></li>
<li><a class="reference internal" href="#version">version</a></li>
<li><a class="reference internal" href="#image">image</a></li>
<li><a class="reference internal" href="#image-version">image_version</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="index.html"
                          title="previous chapter">Casa-Distro</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="technical.html"
                          title="next chapter">Technical issues</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="technical.html" title="Technical issues"
             >next</a></li>
        <li class="right" >
          <a href="index.html" title="Casa-Distro"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CASA-Distro</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Casa-distro concepts</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017-2022, BrainVISA team &lt;contact@brainvisa.info&gt;.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>