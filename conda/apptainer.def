Bootstrap: docker
From: centos:7

%environment
    export CASA=/casa
    export CASA_CONF=$CASA/conf
    export HOME=$CASA/home
    export CASA_SRC=$CASA/src
    export CASA_BUILD=$CASA/build
    export CASA_INSTALL=$CASA/install
    export CASA_TESTS=$CASA/tests

%post
    mkdir /casa
    #apt update
    #apt install distro-info-data # to get lsb_release

%runscript
    if [ "$UID" != "0" ]; then
        export BRAINVISA_BVMAKER_CFG=$CASA_SRC/bv_maker.cfg
        for f in "$CASA_SRC/environment.sh" "$CASA_CONF/environment.sh" "$CASA/environment.sh"; do
            if [ -e "$f" ]; then
                source "$f"
            fi
        done
        export PATH=/casa/conda/bin:$PATH
        export LD_LIBRARY_PATH=/casa/conda/lib:$LD_LIBRARY_PATH
    fi
    exec "$@"
