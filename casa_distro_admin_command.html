<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>The casa_distro_admin command &#8212; CASA-Distro - BrainVisa / CATI development distribution</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=808b3635" />
    
    <script src="_static/documentation_options.js?v=4f6ddb47"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Automated tests with bbi_daily" href="nightly.html" />
    <link rel="prev" title="The casa_distro command" href="casa_distro_command.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="nightly.html" title="Automated tests with bbi_daily"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="casa_distro_command.html" title="The casa_distro command"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CASA-Distro</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">The casa_distro_admin command</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="the-casa-distro-admin-command">
<h1>The casa_distro_admin command<a class="headerlink" href="#the-casa-distro-admin-command" title="Link to this heading">¶</a></h1>
<p>Creation and publication of casa-distro releases and container images.</p>
<p>Casa_distro is the BrainVISA suite distribution swiss knife.
It allows to setup a virtual environment and launch BrainVISA software.
See <a class="reference external" href="http://brainivsa.info/casa-distro">http://brainivsa.info/casa-distro</a> and
<a class="reference external" href="https://github.com/brainvisa/casa-distro">https://github.com/brainvisa/casa-distro</a> for more information</p>
<p>Version : 3.2.0</p>
<p>usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">casa_distro_admin</span> <span class="o">&lt;</span><span class="n">general</span> <span class="n">options</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">command</span> <span class="n">parameters</span><span class="o">&gt;...</span><span class="p">]</span>
</pre></div>
</div>
<dl>
<dt>general optional arguments:</dt><dd><dl class="option-list">
<dt><kbd><span class="option">-v</span>, <span class="option">--verbose</span></kbd></dt>
<dd><p>Display as much information as possible.</p>
</dd>
<dt><kbd><span class="option">--version</span></kbd></dt>
<dd><p>Display casa-distro version number and exit.</p>
</dd>
<dt><kbd><span class="option">-h</span>, <span class="option">--help</span></kbd></dt>
<dd><p>Display help message and exit.
If used after command name, display only the help of this
command.</p>
</dd>
</dl>
</dd>
</dl>
<section id="common-parameters">
<h2>Common parameters:<a class="headerlink" href="#common-parameters" title="Link to this heading">¶</a></h2>
<p>Most commands accept more or less the same parameters.</p>
<p>Many subcommands need <a class="reference internal" href="concepts.html#environment"><span class="std std-ref">environment</span></a> selection specifications: <a class="reference internal" href="casa_distro_command.html#environment-options"><span class="std std-ref">see the documentation on how to specify an environment</span></a>.</p>
<dl>
<dt>base_directory</dt><dd><p>default= <code class="docutils literal notranslate"><span class="pre">$HOME/casa_distro</span></code></p>
<p>Directory where images and environments are stored. This parameter
can be passed on the commandline, or set via the
<code class="docutils literal notranslate"><span class="pre">CASA_BASE_DIRECTORY</span></code> environment variable.</p>
</dd>
</dl>
</section>
<section id="commands">
<h2>Commands:<a class="headerlink" href="#commands" title="Link to this heading">¶</a></h2>
<section id="help">
<span id="casa-distro-admin-help-help"></span><h3>help<a class="headerlink" href="#help" title="Link to this heading">¶</a></h3>
<p>Print global help or help about a command.</p>
<section id="parameters">
<h4>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h4>
<dl class="simple">
<dt>format</dt><dd><p>format help text in a given text format. Valid values are “text”
(default) for raw text, or rst (RST/sphinx format).</p>
</dd>
<dt>full</dt><dd><p>if <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>, display each subcommand parameters
documentation in the general help.</p>
</dd>
</dl>
</section>
</section>
<section id="singularity-deb">
<span id="casa-distro-admin-singularity-deb-help"></span><h3>singularity_deb<a class="headerlink" href="#singularity-deb" title="Link to this heading">¶</a></h3>
<p>Create a Debian package to install Singularity.
Perform the whole installation process from a rw system and Singularity
source. Then put the result in a <code class="docutils literal notranslate"><span class="pre">*.deb</span></code> file.</p>
<section id="id1">
<h4>Parameters<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<dl>
<dt>dockerhub:</dt><dd><p>default=ubuntu:20.04</p>
<p>Name of the base image system to pull from DockerHub.</p>
</dd>
<dt>output_dir:</dt><dd><p>default=/home/runner/work/casa-distro/casa-distro/doc/source</p>
<p>Location of the resulting Debian package file.</p>
</dd>
<dt>version:</dt><dd><p>default=3.8.3</p>
<p>Version of Singularity to use. This must be a valid release version.
Go language is not included in the final package.</p>
</dd>
</dl>
</section>
</section>
<section id="create-base-image">
<span id="casa-distro-admin-create-base-image-help"></span><h3>create_base_image<a class="headerlink" href="#create-base-image" title="Link to this heading">¶</a></h3>
<p>Create a new virtual image</p>
<p>Creating the casa-system image:</p>
<ul>
<li><p>For Singularity you need to run these commands in order to create the
casa-system image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="s2">&quot;$CASA_BASE_DIRECTORY&quot;</span>
<span class="n">singularity</span> <span class="n">pull</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">18.04</span><span class="o">.</span><span class="n">sif</span> <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">ubuntu</span><span class="p">:</span><span class="mf">18.04</span>
</pre></div>
</div>
<p>Then you can directly use the ubuntu image as base for the run image. You
may build a “system” image as follows, but it’s not needed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">casa_distro_admin</span> <span class="n">create_base_image</span> <span class="n">base</span><span class="o">=</span><span class="n">ubuntu</span><span class="o">-</span><span class="mf">18.04</span><span class="o">.</span><span class="n">sif</span> \
    <span class="nb">type</span><span class="o">=</span><span class="n">system</span> <span class="n">image_version</span><span class="o">=</span><span class="mf">5.0</span>
</pre></div>
</div>
</li>
<li><p>For VirtualBox:</p>
<ol class="arabic">
<li><p>Download a Ubuntu image to your CASA base directory, e.g.
lubuntu-22.04.1-desktop-amd64.iso</p></li>
<li><p>Run create_user_image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">casa_distro_admin</span> <span class="n">create_user_image</span> \
    <span class="n">container_type</span><span class="o">=</span><span class="n">vbox</span> \
    <span class="nb">type</span><span class="o">=</span><span class="n">system</span> \
    <span class="n">base</span><span class="o">=</span><span class="n">lubuntu</span><span class="o">-</span><span class="mf">22.04.1</span><span class="o">-</span><span class="n">desktop</span><span class="o">-</span><span class="n">amd64</span><span class="o">.</span><span class="n">iso</span> \
    <span class="n">image_version</span><span class="o">=</span><span class="mf">5.3</span>
</pre></div>
</div>
</li>
<li><p>Follow the instructions that are printed in the terminal to install
and configure Lubuntu appropriately.</p></li>
</ol>
</li>
</ul>
<section id="id2">
<h4>Parameters<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h4>
<dl>
<dt>type</dt><dd><p>type of image to publish. Either “system” for a base system image, or
“run” for an image used in a user environment, or “dev” for a developer
image.</p>
</dd>
<dt><a class="reference internal" href="concepts.html#env-name"><span class="std std-ref">name</span></a></dt><dd><p>default=casa-{type}-{image_version}</p>
<p>If given, select environment by its name. It replaces type, distro,
branch and system and is shorter to select one.</p>
</dd>
<dt>base</dt><dd><p>Source file used to build the image. The default value depends on image
type and container type.</p>
</dd>
<dt>output</dt><dd><p>default=/home/runner/casa_distro/{name}.{extension}</p>
<p>File location where the image is created.</p>
</dd>
<dt>container_type</dt><dd><p>default=singularity</p>
<p>Type of virtual appliance to use. Either “singularity”, “vbox” or
“docker”.</p>
</dd>
<dt>image_version</dt><dd><p>default=</p>
<p>Version (or branch) of the image</p>
</dd>
<dt>verbose</dt><dd><p>default=True</p>
<p>Print more detailed information if value is <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd>
<dt>cleanup (effective only if container_type=singularity)</dt><dd><p>default=yes</p>
<p>If “no”, “false” or “0”, do not cleanup after a failure during image
building. This may allow to debug a problem after the failure. For
instance, with Singularity one can use a command like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">singularity</span> <span class="n">run</span> <span class="o">--</span><span class="n">writable</span>
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">rootfs</span><span class="o">-</span><span class="mi">79744</span><span class="n">fb2</span><span class="o">-</span><span class="n">f3a7</span><span class="o">-</span><span class="mi">11</span><span class="n">ea</span><span class="o">-</span><span class="n">a080</span><span class="o">-</span><span class="n">ce9ed5978945</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
</dd>
<dt>force (allowed only if container_type=singularity)</dt><dd><p>default=no</p>
<p>If <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code> or 1, erase existing image without asking any
question.</p>
</dd>
<dt>fakeroot (allowed only if container_type=singularity)</dt><dd><p>default=yes</p>
<p>If <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code> or 1, use singularity –fakeroot for building the
images (this is the recommended wby). Otherwise, “sudo singularity”
must be used so singularity has root access on the host.</p>
</dd>
<dt>memory (allowed only if container_type=vbox)</dt><dd><p>default=8192</p>
<p>Size in MiB of memory allocated for virtual machine.</p>
</dd>
<dt>video_memory (allowed only if container_type=vbox)</dt><dd><p>default=50</p>
<p>Size in MiB of video memory allocated for virtual machine.</p>
</dd>
<dt>disk_size (allowed only if container_type=vbox)</dt><dd><p>default=131072</p>
<p>For vbox container type only. Size in MiB of maximum disk size of
virtual machine.</p>
</dd>
<dt>gui (allowed only if container_type=vbox)</dt><dd><p>default=no</p>
<p>For vbox container type only. If value is “yes”, “true” or “1”, display
VirtualBox window.</p>
</dd>
</dl>
</section>
</section>
<section id="publish-base-image">
<span id="casa-distro-admin-publish-base-image-help"></span><h3>publish_base_image<a class="headerlink" href="#publish-base-image" title="Link to this heading">¶</a></h3>
<p>Upload an image to BrainVISA web site.</p>
<p>Upload is done with rsync in the following remote directory:</p>
<blockquote>
<div><p><a class="reference external" href="mailto:brainvisa&#37;&#52;&#48;brainvisa&#46;info">brainvisa<span>&#64;</span>brainvisa<span>&#46;</span>info</a>:/var/www/html/brainvisa.info_download/</p>
</div></blockquote>
<p>This directory location can be customized with
the following environment variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BRAINVISA_PUBLISH_LOGIN</span> <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">brainvisa</span><span class="p">)</span>
<span class="n">BRAINVISA_PUBLISH_SERVER</span> <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">brainvisa</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
<span class="n">BRAINVISA_PUBLISH_DIR</span> <span class="p">(</span><span class="n">default</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">brainvisa</span><span class="o">.</span><span class="n">info_download</span><span class="p">)</span>
</pre></div>
</div>
<section id="id3">
<h4>Parameters<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h4>
<dl>
<dt>type</dt><dd><p>type of image to publish. Either “system” for a base system image, or
“run” for an image used in a user environment, or “dev” for a developer
image.</p>
</dd>
<dt><a class="reference internal" href="concepts.html#image"><span class="std std-ref">image</span></a></dt><dd><p>Force usage of a specific virtual image instead of the one defined
in the environment configuration.</p>
</dd>
<dt>container_type</dt><dd><p>default=singularity
Type of virtual appliance to use. Either “singularity”, “vbox” or
“docker”.</p>
</dd>
<dt>verbose</dt><dd><p>default=True</p>
<p>Print more detailed information if value is <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd>
</dl>
</section>
</section>
<section id="create-user-image">
<span id="casa-distro-admin-create-user-image-help"></span><h3>create_user_image<a class="headerlink" href="#create-user-image" title="Link to this heading">¶</a></h3>
<p>Create a “user” image given a development environment.
The development environment is selected among existing ones its
distro and system or simply by its name. Only development environments
using the master branch are considered.
This command can perform three steps. Each step can be ignored by setting
the corresponding option to “no” :</p>
<ul class="simple">
<li><p>install: perform an installation of the development environment into its
installation directory. This modify the development environment by
updating its installation directory.</p></li>
<li><p>generate: generate a new image for the development environment. The new
image is based on base_image and the installation directory of the
development environment is copied into the image in /casa/install.</p></li>
</ul>
<section id="id4">
<h4>Parameters<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h4>
<dl>
<dt>version [REQUIRED]</dt><dd><p>Version of the release to create.</p>
</dd>
<dt>name</dt><dd><p>default={distro}-{version}
Name given to the created image.</p>
</dd>
<dt>base_image</dt><dd><p>default={base_directory}/casa-run-{image_version}{extension}
Name of the “run” image used to generate the new user image</p>
</dd>
<dt><a class="reference internal" href="concepts.html#distro"><span class="std std-ref">distro</span></a></dt><dd><p>default=None</p>
<p>If given, select environment having the given distro name.</p>
</dd>
<dt><a class="reference internal" href="concepts.html#branch"><span class="std std-ref">branch</span></a></dt><dd><p>default=None</p>
<p>If given, select environment having the given branch.</p>
</dd>
<dt><a class="reference internal" href="concepts.html#system"><span class="std std-ref">system</span></a></dt><dd><p>default=None</p>
<p>If given, select environments having the given system name.</p>
</dd>
<dt><a class="reference internal" href="concepts.html#image-version"><span class="std std-ref">image_version</span></a></dt><dd><p>default=None</p>
<p>If given, select environments having the given image version.</p>
</dd>
<dt>environment_name</dt><dd><p>If given, select dev environment by its name.</p>
</dd>
<dt>container_type</dt><dd><p>default=None
Type of virtual appliance to use. Either “singularity”, “vbox” or
“docker”.</p>
</dd>
<dt>output</dt><dd><p>default={base_directory}/{name}{extension}
Path of the output image.</p>
</dd>
<dt>force</dt><dd><p>default=no
If “yes”, “true” or 1, erase existing image without asking any
question.</p>
</dd>
<dt>fakeroot (allowed only if container_type=singularity)</dt><dd><p>default=yes
If <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code> or 1, use singularity –fakeroot for building the
images (this is the recommended wby). Otherwise, “sudo singularity”
must be used so singularity has root access on the host.</p>
</dd>
<dt>base_directory</dt><dd><p>default= <code class="docutils literal notranslate"><span class="pre">$HOME/casa_distro</span></code></p>
<p>Directory where images and environments are stored. This parameter
can be passed on the commandline, or set via the
<code class="docutils literal notranslate"><span class="pre">CASA_BASE_DIRECTORY</span></code> environment variable.</p>
</dd>
<dt>install</dt><dd><p>default=yes
If “true”, “yes” or “1”, perform the installation steps:
‘make install-runtime’, as well as ‘make install-doc’ and
‘make install-test’, depending on the install_doc and install_test
parameters.
If “false”, “no” or “0”, skip all installation steps</p>
</dd>
<dt>install_doc</dt><dd><p>default=yes
If “true”, “yes” or “1”, run ‘make install-doc’ as part of the install
step.
If “false”, “no” or “0”, skip this step</p>
</dd>
<dt>install_test</dt><dd><p>default=yes
If “true”, “yes” or “1”, run ‘make install-test’ as part of the install
step.
If “false”, “no” or “0”, skip this step</p>
</dd>
<dt>install_thirdparty</dt><dd><p>default=none
If “none”, no third-party software is installed in the image. If
“all”, all available software will be installed during the <code class="docutils literal notranslate"><span class="pre">generate</span></code>
step. If “default”, a default list of software will be installed. If
starting with “<a class="reference external" href="file://">file://</a>”, then the thirdparty install list will be read
from a JSON file. Other values are understood as a list of software
(“spm12-standalone,freesurfer”). Each will be installed from their host
system location into <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code> on the container image. Software
location will be searched in a small search list (/usr/local,
/drf/local, /i2bm/local). If installed in another location, this
location may be passed after a <code class="docutils literal notranslate"><span class="pre">=</span></code> sign in the software name, ex:
<code class="docutils literal notranslate"><span class="pre">spm12-standalone=/opt/spm,freesurfer</span></code>.
If a JSON file is used, then the file syntax is a dictionary, keys are
thirdparty software names (“spm12-standalone”), and values are
directories. If default locations are expected, then the value may be
null.</p>
</dd>
<dt>generate</dt><dd><p>default=yes
If “true”, “yes” or “1”, perform the image creation step.
If “false”, “no” or “0”, skip this step</p>
</dd>
<dt>cleanup</dt><dd><p>default=yes
If “false”, “no” or “0”, do NOT clean up the temp image during the
generate step after failed build, can be helpful for debugging</p>
</dd>
<dt>zip</dt><dd><p>default=no
If “true”, “yes” or “1”, zip the installed files for an “online”
installation.</p>
</dd>
<dt>verbose</dt><dd><p>default=True</p>
<p>Print more detailed information if value is <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd>
</dl>
</section>
</section>
<section id="publish-user-image">
<span id="casa-distro-admin-publish-user-image-help"></span><h3>publish_user_image<a class="headerlink" href="#publish-user-image" title="Link to this heading">¶</a></h3>
<p>Upload a “user” image to the BrainVISA web site.</p>
<p>Upload is done with rsync in the following remote directory:</p>
<blockquote>
<div><p><a class="reference external" href="mailto:brainvisa&#37;&#52;&#48;brainvisa&#46;info">brainvisa<span>&#64;</span>brainvisa<span>&#46;</span>info</a>:/var/www/html/brainvisa.info_download/</p>
</div></blockquote>
<p>This directory location can be customized with
the following environment variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BRAINVISA_PUBLISH_LOGIN</span> <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">brainvisa</span><span class="p">)</span>
<span class="n">BRAINVISA_PUBLISH_SERVER</span> <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">brainvisa</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
<span class="n">BRAINVISA_PUBLISH_DIR</span> <span class="p">(</span><span class="n">default</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">brainvisa</span><span class="o">.</span><span class="n">info_download</span><span class="p">)</span>
</pre></div>
</div>
<section id="id5">
<h4>Parameters<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h4>
<dl class="simple">
<dt><a class="reference internal" href="concepts.html#image"><span class="std std-ref">image</span></a></dt><dd><p>Force usage of a specific virtual image instead of the one defined
in the environment configuration.</p>
</dd>
</dl>
</section>
</section>
<section id="bbi-daily">
<span id="casa-distro-admin-bbi-daily-help"></span><h3>bbi_daily<a class="headerlink" href="#bbi-daily" title="Link to this heading">¶</a></h3>
<p>BrainVISA Build infrastructure: daily/nightly automated tests</p>
<p>In BrainVISA Build Infrastructure (BBI), the <code class="docutils literal notranslate"><span class="pre">casa_distro_admin</span>
<span class="pre">bbi_daily</span></code> command orchestrates automated builds and tests in a given
<em>base directory</em>. The <code class="docutils literal notranslate"><span class="pre">bbi_daily</span></code> command will run the following steps,
while (optionally) logging detailed output to a Jenkins server. See
<a class="reference internal" href="nightly.html"><span class="doc">Automated tests with bbi_daily</span></a> for a complete introduction to automated tests.</p>
<ol class="arabic simple">
<li><p>Self-update casa_distro using ‘git pull’ and restart itself for the next
steps</p></li>
<li><p>Select <em>dev</em> environments based on the provided filters (distro, branch,
system, image_version, name)</p></li>
<li><p>Update casa-dev and casa-run images used by the selected environments to
the latest version available from the BrainVISA website</p></li>
<li><p>For every selected <em>dev</em> environment, perform the following tasks:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bv_maker</span> <span class="pre">sources</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bv_maker</span> <span class="pre">configure</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bv_maker</span> <span class="pre">build</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bv_maker</span> <span class="pre">doc</span></code></p></li>
<li><p>perform all tests in the <em>dev</em> environment (running the same commands
as <code class="docutils literal notranslate"><span class="pre">bv_maker</span> <span class="pre">test</span></code>)</p></li>
<li><p>create or update a user image with <code class="docutils literal notranslate"><span class="pre">casa_distro_admin</span>
<span class="pre">create_user_image</span></code> (i.e. install the compiled software in a new
<em>user image</em> based on the <code class="docutils literal notranslate"><span class="pre">casa-run</span></code> image, where the software is
installed under <code class="docutils literal notranslate"><span class="pre">/casa/install</span></code>)</p></li>
<li><p>install that user image into  a fresh <em>user</em> environment (reference
test data are automatically linked from the <em>dev</em> environment)</p></li>
<li><p>perform all tests in that <em>user</em> environment</p></li>
</ol>
</li>
</ol>
<p>The process can be controlled with the command-line options described
below, as well as some configuration keys that can be added to the
<code class="docutils literal notranslate"><span class="pre">casa_distro.json</span></code> of each dev environment:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ctest_options</span></code>: list of command-line options to pass to <code class="docutils literal notranslate"><span class="pre">ctest</span></code> on
the command-line. <code class="docutils literal notranslate"><span class="pre">ctest</span></code> is used for listing the tests, so you may
pass filtering options to restrict the set of tests being run (e.g.
<code class="docutils literal notranslate"><span class="pre">[&quot;-R&quot;,</span> <span class="pre">&quot;disco&quot;]</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bbi_user_config</span></code>: an optional dictionary for customizing the creation
of a the user image and the user environment, where tests of the user
image will be run. This dictionary can contain these keys:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the environment where the user image will be set
up. Default: <code class="docutils literal notranslate"><span class="pre">dev_config['name']</span> <span class="pre">+</span> <span class="pre">'-userimage'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">directory</span></code>: the full path where the user environment will be set up.
<strong>Warning: this directory is erased every time ``bbi_daily`` is run.</strong>
Default: <code class="docutils literal notranslate"><span class="pre">{base_directory}</span> <span class="pre">+</span> <span class="pre">name</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image</span></code>: the full path where the user image will be created.
Default: <code class="docutils literal notranslate"><span class="pre">{base_directory}</span> <span class="pre">+</span> <span class="pre">name</span> <span class="pre">+</span> <span class="pre">extension</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">version</span></code>: the version string that will be set in the user image,
e.g. available as the <code class="docutils literal notranslate"><span class="pre">CASA_VERSION</span></code> environment variable and as the
<code class="docutils literal notranslate"><span class="pre">version</span></code> metadata key. This value <code class="docutils literal notranslate"><span class="pre">version</span></code> is passed to
<code class="xref py py-func docutils literal notranslate"><span class="pre">time.strftime()</span></code>. Default: <code class="docutils literal notranslate"><span class="pre">'%Y-%m-%d'</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setup_commands</span></code>: list of shell commands that will be run in the
newly created user environment. May be used to run post-setup tasks,
such as configuring additional files in the home directory of the user
(e.g. configuring MATLAB licences…).</p></li>
</ul>
</li>
</ul>
<section id="id6">
<h4>Parameters<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h4>
<dl>
<dt><a class="reference internal" href="concepts.html#distro"><span class="std std-ref">distro</span></a></dt><dd><p>default=None</p>
<p>If given, select environment having the given distro name.</p>
</dd>
<dt><a class="reference internal" href="concepts.html#branch"><span class="std std-ref">branch</span></a></dt><dd><p>default=None</p>
<p>If given, select environment having the given branch.</p>
</dd>
<dt><a class="reference internal" href="concepts.html#system"><span class="std std-ref">system</span></a></dt><dd><p>default=None</p>
<p>If given, select environments having the given system name.</p>
</dd>
<dt><a class="reference internal" href="concepts.html#image-version"><span class="std std-ref">image_version</span></a></dt><dd><p>default=None</p>
<p>If given, select environments having the given image version.</p>
</dd>
<dt><a class="reference internal" href="concepts.html#env-name"><span class="std std-ref">name</span></a></dt><dd><p>default=None</p>
<p>If given, select environment by its name. It replaces type, distro,
branch and system and is shorter to select one.</p>
</dd>
<dt>jenkins_server</dt><dd><p>default = None
Base URL of the Jenkins server used to send logs (e.g.
<a class="reference external" href="https://brainvisa.info/builds">https://brainvisa.info/builds</a>). If none is given, logs are
written to standard output.</p>
</dd>
<dt>jenkins_auth</dt><dd><p>default = {base_directory}/jenkins_auth
Name of a file containing user name and password (can be a token)
to use to contact Jenkins server REST API. The file must have only
two lines with login on first line and password on second.</p>
</dd>
<dt>update_casa_distro</dt><dd><p>default = yes
If true, yes or 1, update casa_distro</p>
</dd>
<dt>update_base_images</dt><dd><p>default = yes
Boolean indicating if the update images step must be done</p>
</dd>
<dt>bv_maker_steps</dt><dd><p>default = sources,configure,build,doc
Coma separated list of bv_maker commands to perform on dev
environments. May be empty to do nothing.</p>
</dd>
<dt>dev_tests</dt><dd><p>default = yes
Boolean indicating if the tests must be performed on dev environments</p>
</dd>
<dt>update_user_images</dt><dd><p>default = yes
Boolean indicating if images of user environment must be recreated</p>
</dd>
<dt>recreate_user_envs</dt><dd><p>default = yes
Boolean indicating if user environments must be wiped and recreated
using singularity –bind &lt;dir&gt;:/casa/setup …</p>
</dd>
<dt>user_tests</dt><dd><p>default = yes
Boolean indicating if the tests must be performed on user environments</p>
</dd>
<dt>install_thirdparty</dt><dd><p>default = none
passed to “create_user_image” when update_user_images is true</p>
</dd>
<dt>base_directory</dt><dd><p>default= <code class="docutils literal notranslate"><span class="pre">$HOME/casa_distro</span></code></p>
<p>Directory where images and environments are stored. This parameter
can be passed on the commandline, or set via the
<code class="docutils literal notranslate"><span class="pre">CASA_BASE_DIRECTORY</span></code> environment variable.</p>
</dd>
<dt>verbose</dt><dd><p>default=None</p>
<p>Print more detailed information if value is <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd>
</dl>
</section>
</section>
<section id="local-install">
<span id="casa-distro-admin-local-install-help"></span><h3>local_install<a class="headerlink" href="#local-install" title="Link to this heading">¶</a></h3>
<p>Run the installation procedure to create a run or dev image on the
local machine. Installation can be don step by step. This command
is typically used in a VirtualBox machine to debug image creation
scenario.</p>
<section id="id7">
<h4>Parameters<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h4>
<dl>
<dt>type</dt><dd><p>Type of image to install. Either “run” or “dev”.</p>
</dd>
<dt>action</dt><dd><p>default=None</p>
<p>If not given, list the possible actions for the selected type and
indicate if they were done or not. Can have one of the following
values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="n">perform</span> <span class="n">the</span> <span class="n">nex</span> <span class="n">action</span> <span class="ow">not</span> <span class="n">already</span> <span class="n">done</span>
<span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="n">perform</span> <span class="nb">all</span> <span class="n">action</span> <span class="ow">not</span> <span class="n">already</span> <span class="n">done</span>
<span class="n">coma</span> <span class="n">separated</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">acions</span><span class="p">:</span>
    <span class="n">perform</span> <span class="nb">all</span> <span class="n">selected</span> <span class="n">actions</span> <span class="n">even</span> <span class="k">if</span> <span class="n">they</span> <span class="n">were</span> <span class="n">already</span> <span class="n">done</span>
</pre></div>
</div>
</dd>
<dt>version</dt><dd><p>default=*</p>
<p>Image version to use for searching an image builder file. This is
used as a shell pattern, the default value match any version.</p>
</dd>
<dt>log_file</dt><dd><p>default=/etc/casa_local_install.log</p>
<p>File where information about steps that have been performed is stored.</p>
</dd>
<dt>user</dt><dd><p>default=brainvisa</p>
<p>Name of the user account to use for non root commands.</p>
</dd>
</dl>
</section>
</section>
<section id="convert-image">
<span id="casa-distro-admin-convert-image-help"></span><h3>convert_image<a class="headerlink" href="#convert-image" title="Link to this heading">¶</a></h3>
<p>Convert a virtual image to another container type</p>
<section id="id8">
<h4>Parameters<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h4>
<dl>
<dt>source</dt><dd><p>Source image file.</p>
</dd>
<dt>container_type</dt><dd><p>default=docker</p>
<p>Type of virtual appliance to use. Either “singularity”, “vbox” or
“docker”.</p>
</dd>
<dt>convert_from</dt><dd><p>default=None</p>
<p>Convert from this container type. If not specified, take it from the
source container metadata.</p>
</dd>
<dt>verbose</dt><dd><p>default=True</p>
<p>Print more detailed information if value is <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd>
</dl>
</section>
</section>
</section>
<section id="images-and-releases-creation">
<h2>Images and releases creation<a class="headerlink" href="#images-and-releases-creation" title="Link to this heading">¶</a></h2>
<p>A casa-distro release is done by a member of the BrainVISA team using the <code class="docutils literal notranslate"><span class="pre">casa_distro_admin</span></code> command. This document contains all the steps that are necessary to build and publish all versions of casa-distro images.</p>
</section>
<section id="creation-a-base-virtualbox-image">
<h2>Creation a base VirtualBox image<a class="headerlink" href="#creation-a-base-virtualbox-image" title="Link to this heading">¶</a></h2>
<p>The base VirtualBox image is a minimal configuration of a system image downloaded from internet as an <code class="docutils literal notranslate"><span class="pre">*.iso</span></code> file. It serves as starting point for the building of run and dev images. Once created, the image is published on BrainVISA website in the following URL <code class="docutils literal notranslate"><span class="pre">http://brainvisa.info/casa-distro/casa-&lt;iso_name&gt;.ova</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;iso</span> <span class="pre">name&gt;̀</span></code> is the name of the <code class="docutils literal notranslate"><span class="pre">*.iso</span></code> file of the distribution. For instance if one uses <code class="docutils literal notranslate"><span class="pre">ubuntu-18.04.4-desktop-amd64.iso</span></code>, the uploaded image name would be <code class="docutils literal notranslate"><span class="pre">casa-ubuntu-18.04.4-desktop-amd64.ova</span></code>.</p>
<ol class="arabic simple">
<li><p>Install VirtualBox version 6 or greater</p></li>
<li><p>Download an Ubuntu iso file from internet (any Debian based distro may work but only recent Ubuntu LTS are tested).</p></li>
<li><p>Run <cite>casa_distro_admin create_system</cite> to create an empty VirtualBox image with appropriate base settings (e.g. enough maximum disk size)</p></li>
<li><p>Perform Ubuntu minimal installation with an autologin account named “brainvisa” and with password “brainvisa”</p></li>
<li><p>Perform system updates and install kernel module creation packages :</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>upgrade
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>gcc<span class="w"> </span>make<span class="w"> </span>perl
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>Set root password to “brainvisa” (this is necessary to automatically connect to the VM to perform post-install)</p></li>
<li><p>Reboot the VM</p></li>
<li><p>Download and install VirtualBox guest additions</p></li>
<li><p>Shut down the VM</p></li>
<li><p>Configure the VM in VirualBox (especially 3D acceleration, processors and memory)</p></li>
</ol>
</section>
<section id="managing-container-images">
<h2>Managing container images<a class="headerlink" href="#managing-container-images" title="Link to this heading">¶</a></h2>
<section id="singularity-and-docker">
<h3>Singularity and Docker<a class="headerlink" href="#singularity-and-docker" title="Link to this heading">¶</a></h3>
<p>In a general way, we designed casa-distro first using <a class="reference external" href="https://www.docker.com">Docker</a>, and then extended it to <a class="reference external" href="https://www.sylabs.io/">Singularity</a>. We use Singularity by actually converting Docker images, so images should be built first using Docker. So Docker is needed to build Singularity images for Casa-distro (this is not needed for regular users, which just download system images, and can use singularity alone, or docker alone).</p>
<p>Thus, to build a singularity image, one needs to use first <code class="docutils literal notranslate"><span class="pre">casa_distro_admin</span> <span class="pre">create_docker</span></code>, then <code class="docutils literal notranslate"><span class="pre">casa_distro_admin</span> <span class="pre">create_singularity</span></code>.</p>
</section>
<section id="sharing-images">
<h3>Sharing images<a class="headerlink" href="#sharing-images" title="Link to this heading">¶</a></h3>
<p>Images can be uploaded to a centralized place to allow other users to use them.</p>
<p>By default <code class="docutils literal notranslate"><span class="pre">publish_docker</span></code> will use <a class="reference external" href="https://hub.docker.com/">Docker Hub</a>, which requires an account and access rights to push images.</p>
<p>Singularity did not have a public hub by the time we started casa-distro, so <code class="docutils literal notranslate"><span class="pre">publish_singularity</span></code> will push by default somewhere on the <a class="reference external" href="http://brainvisa.info">BrainVISA web site</a>, which also requires to have access to the website account to push. We could use <a class="reference external" href="https://singularity-hub.org/">Singularity Hub</a> in the future.</p>
<p>Downloading and updating images do not need any access rights, they are public.</p>
</section>
<section id="designing-new-images">
<h3>Designing new images<a class="headerlink" href="#designing-new-images" title="Link to this heading">¶</a></h3>
<p><em>create_docker</em> may be used to update and rebuild the images which are proposed inside the <em>casa-distro</em> distribution, but this specific use has a limited benefit since they are normally pre-built and are downloaded from the hubs when needed.</p>
<p><em>create_docker</em> may prove useful however for an application designer who needs to ship specific or additional system packages in the images. In this situation a new image type needs to be designed.</p>
<p>New image types correspond to subdirectories which will looked for in the following directory trees (when they exist):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;workflow_repository&gt;/share/docker/&lt;image_name&gt;/&lt;system&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$HOME/.config/casa-distro/docker/&lt;image_name&gt;/&lt;system&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$HOME/.casa-distro/docker/&lt;image_name&gt;/&lt;system&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;casa_builtin&gt;/docker/&lt;image_name&gt;/&lt;system&gt;</span></code></p></li>
</ul>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;workflow_repository&gt;</span></code> is the main workflow repository either passed via the <code class="docutils literal notranslate"><span class="pre">--repository</span></code> option, or via the <code class="docutils literal notranslate"><span class="pre">CASA_DEFAULT_REPOSITORY</span></code> environment variable, or in the default location <code class="docutils literal notranslate"><span class="pre">$HOME/casa_distro</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;casa_builtin&gt;</span></code> if the builtin share directory of casa-distro (or its sources)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;image_name&gt;</span></code> is a name (or type name) for the image, like the builtin ones <code class="docutils literal notranslate"><span class="pre">casa-test</span></code>, <code class="docutils literal notranslate"><span class="pre">casa-dev</span></code> etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;system&gt;</span></code> is the name of the system running inside the docker image (the builtin ones are <code class="docutils literal notranslate"><span class="pre">ubuntu-18.04</span></code>, <code class="docutils literal notranslate"><span class="pre">ubuntu-16.04</span></code>, <code class="docutils literal notranslate"><span class="pre">ubuntu-14.04</span></code>, <code class="docutils literal notranslate"><span class="pre">ubuntu-12.04</span></code>, <code class="docutils literal notranslate"><span class="pre">centos-7.4</span></code>, <code class="docutils literal notranslate"><span class="pre">windows-7-32</span></code>, <code class="docutils literal notranslate"><span class="pre">windows-7-64</span></code>.</p></li>
</ul>
<p>So custom, user-defined images can be added in a personal directory.
Such an image definition directory should contain at least two files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">casa_distro_docker.yaml</span></code> is a Yaml file definig dependencies, name and tags for the image. Ex:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dependencies</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../../casa-dev</span>
<span class="nt">image_sources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytorch</span>
<span class="w">    </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-16.04</span>
<span class="w">    </span><span class="nt">visibility</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public</span>
</pre></div>
</div>
<ul class="simple">
<li><p>a <a class="reference external" href="https://docs.docker.com/engine/reference/builder/">Dockerfile</a>
The Dockerfile may (should) be based on another image, in the usual way of building docker images. Thus an existing casa-distro image can be the base for a new one.</p></li>
</ul>
<p>Once an image is created with docker, it can be converted to singularity using <code class="docutils literal notranslate"><span class="pre">casa_distro</span> <span class="pre">create_singularity</span></code>.</p>
</section>
</section>
<section id="creating-a-modified-brainvisa-distribution">
<h2>Creating a modified BrainVISA distribution<a class="headerlink" href="#creating-a-modified-brainvisa-distribution" title="Link to this heading">¶</a></h2>
<p>If you are a toolbox developer and want to share a modified BrainVISA distribution with your additional tools and dependencies in it, here is a recipe to build a singularity/apptainer image for your needs. You will need sudo permission on your host system to do so.</p>
<ul>
<li><p>create the modified run image:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apptainer<span class="w"> </span>build<span class="w"> </span>-s<span class="w"> </span>casa-run-5.3-23<span class="w"> </span>casa-run-5.3-23.sif
sudo<span class="w"> </span>apptainer<span class="w"> </span>run<span class="w"> </span>-w<span class="w"> </span>casa-run-5.3-23<span class="w"> </span>bash
</pre></div>
</div>
<p>in this bash, install whatever you need, like (just examples):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>apt<span class="w"> </span>update
apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>whatever
pip3<span class="w"> </span>install<span class="w"> </span>something_else
cp<span class="w"> </span>-a<span class="w"> </span>/home/someone/my_additional_software<span class="w"> </span>/usr/local/
ln<span class="w"> </span>-s<span class="w"> </span>/usr/local/my_additional_software/bin/*<span class="w"> </span>/usr/local/bin/
</pre></div>
</div>
<p>and so on. Then exit the container shell</p>
</li>
<li><p>Optionally you can test the image with an existing dev environment, using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>my_environment/bin/bv<span class="w"> </span><span class="nv">image</span><span class="o">=</span>casa-run-5.3-23<span class="w"> </span>bash
</pre></div>
</div>
<p>here, test the software you have installed etc. You can test brainvisa tools with the “bv_env” wrapper which sets up env variables and paths:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/casa/host/build/bin/bv_env<span class="w"> </span>anatomist
</pre></div>
</div>
<p>When you’re done, exit the container shell</p>
</li>
<li><p>recreate a .sif file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apptainer<span class="w"> </span>build<span class="w"> </span>casa-run-mod-5.3-23.sif<span class="w"> </span>casa-run-5.3-23
</pre></div>
</div>
<p>(the creation of the user image doesn’t seem to work using a sandbox as a source image, so we need to convert it back to .sif)</p>
</li>
<li><p>In order to use the new run image as a base for a new user image, we need to have a .json metadata file. Just copy it from the original .sif one:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>casa-run-5.3-23.sif.json<span class="w"> </span>casa-run-mod-5.3-23.sif.json
</pre></div>
</div>
<p>(well to do things right we should generate another ID and update the md5 there, but never mind)</p>
</li>
<li><p>create the user image:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is not needed after you have done it once</span>
sudo<span class="w"> </span>apptainer<span class="w"> </span>config<span class="w"> </span>fakeroot<span class="w"> </span>--add<span class="w"> </span><span class="k">$(</span>id<span class="w"> </span>-u<span class="w"> </span>-n<span class="k">)</span>

casa_distro_admin<span class="w"> </span>create_user_image<span class="w"> </span><span class="nv">base_image</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/casa-run-mod-5.3-23.sif<span class="w"> </span><span class="nv">name</span><span class="o">=</span>brainvisa-spn<span class="w"> </span><span class="nv">image_version</span><span class="o">=</span><span class="m">5</span>.3<span class="w"> </span><span class="nv">environment_name</span><span class="o">=</span>brainvisa-master-ubuntu-22.04<span class="w"> </span><span class="nv">container_type</span><span class="o">=</span>singularity<span class="w"> </span><span class="nv">install_thirdparty</span><span class="o">=</span><span class="s2">&quot;spm12-standalone=/usr/local/spm12-standalone&quot;</span><span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="m">1</span>.0.0
</pre></div>
</div>
<p>note that:</p>
<ul class="simple">
<li><p>the new user image will contain brainvisa projects which have been configured and built in your environment (here I use “brainvisa-master-ubuntu-22.04” which is my dev environment), and only them. If you have not all the projects we ship, then your distribution will not contain them.</p></li>
<li><p>in our user images we now include a copy of spm12 standalone, which we specify with the parameter install_thirdparty=”spm12-standalone=/usr/local/spm12-standalone”, which copies an already installed SPM12.</p></li>
</ul>
</li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">The casa_distro_admin command</a><ul>
<li><a class="reference internal" href="#common-parameters">Common parameters:</a></li>
<li><a class="reference internal" href="#commands">Commands:</a><ul>
<li><a class="reference internal" href="#help">help</a><ul>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#singularity-deb">singularity_deb</a><ul>
<li><a class="reference internal" href="#id1">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-base-image">create_base_image</a><ul>
<li><a class="reference internal" href="#id2">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#publish-base-image">publish_base_image</a><ul>
<li><a class="reference internal" href="#id3">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-user-image">create_user_image</a><ul>
<li><a class="reference internal" href="#id4">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#publish-user-image">publish_user_image</a><ul>
<li><a class="reference internal" href="#id5">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bbi-daily">bbi_daily</a><ul>
<li><a class="reference internal" href="#id6">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#local-install">local_install</a><ul>
<li><a class="reference internal" href="#id7">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#convert-image">convert_image</a><ul>
<li><a class="reference internal" href="#id8">Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#images-and-releases-creation">Images and releases creation</a></li>
<li><a class="reference internal" href="#creation-a-base-virtualbox-image">Creation a base VirtualBox image</a></li>
<li><a class="reference internal" href="#managing-container-images">Managing container images</a><ul>
<li><a class="reference internal" href="#singularity-and-docker">Singularity and Docker</a></li>
<li><a class="reference internal" href="#sharing-images">Sharing images</a></li>
<li><a class="reference internal" href="#designing-new-images">Designing new images</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-a-modified-brainvisa-distribution">Creating a modified BrainVISA distribution</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="casa_distro_command.html"
                          title="previous chapter">The casa_distro command</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="nightly.html"
                          title="next chapter">Automated tests with bbi_daily</a></p>
  </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="nightly.html" title="Automated tests with bbi_daily"
             >next</a></li>
        <li class="right" >
          <a href="casa_distro_command.html" title="The casa_distro command"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CASA-Distro</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">The casa_distro_admin command</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2017-2024, BrainVISA team &lt;contact@brainvisa.info&gt;.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>